<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
        .container {
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 240px;
            background-color: #4B0D5A;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #2c3e50;
            transition: all 0.3s ease;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            position: relative;
            overflow-y: auto;
        }
        .sidebar.collapsed {
            width: 0;
            padding: 0;
            overflow: hidden;
        }
        .sidebar-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 15px;
            margin-top: 20px;
        }
        .sidebar-button {
            background-color: transparent;
            color: #e2e8f0;
            border: none;
            border-radius: 8px;
            padding: 12px 15px;
            text-align: left;
            cursor: pointer;
            font-size: 15px;
            width: 100%;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            line-height: 1.2;
        }
        .sidebar-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateX(3px);
        }
        .sidebar-button::before {
            content: "";
            display: inline-block;
            width: 18px;
            height: 18px;
            margin-right: 10px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.8;
        }
        .sidebar-button:nth-child(1)::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6'%3E%3C/path%3E%3C/svg%3E");
        }
        .sidebar-button:nth-child(2)::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z'%3E%3C/path%3E%3C/svg%3E");
        }
        .sidebar-button:nth-child(3)::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z'%3E%3C/path%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 12a3 3 0 11-6 0 3 3 0 016 0z'%3E%3C/path%3E%3C/svg%3E");
        }
        .sidebar-button:nth-child(4)::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23e2e8f0'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z'%3E%3C/path%3E%3C/svg%3E");
        }
        .active-button {
            background-color: rgba(255, 255, 255, 0.15);
            color: #ffffff;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .active-button::before {
            opacity: 1 !important;
        }
        .logout-button {
            background-color: rgba(239, 68, 68, 0.2);
            color: #fecaca;
            margin-top: auto;
            width: calc(100% - 30px);
            margin-left: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            padding: 12px 15px;
            transition: all 0.2s ease;
        }
        .logout-button:hover {
            background-color: rgba(239, 68, 68, 0.3);
        }
        .logout-button::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23fecaca'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1'%3E%3C/path%3E%3C/svg%3E");
        }
        .app-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px 20px;
            color: white;
            font-size: 22px;
            font-weight: bold;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 10px;
        }
        .app-logo span {
            color: #3b82f6;
        }
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        .header-left {
            display: flex;
            align-items: center;
        }
        .menu-icon {
            color: #2196F3;
            font-size: 24px;
            cursor: pointer;
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .back-icon, .notification-icon, .profile-icon {
            color: #2196F3;
            font-size: 20px;
            cursor: pointer;
        }
        .admin-title {
            color: #2196F3;
            font-size: 24px;
            margin-bottom: 30px;
            font-weight: bold;
        }
        .quick-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            flex: 1;
            min-width: 200px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #555;
        }
        .stat-card p {
            margin: 0;
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .admin-section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .section-title {
            font-size: 18px;
            margin-top: 0;
            margin-bottom: 20px;
            color: #333;
        }
        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }
        .admin-table th, .admin-table td {
            text-align: left;
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }
        .admin-table th {
            background-color: #f5f5f5;
            font-weight: bold;
            color: #333;
        }
        .admin-table tr:hover {
            background-color: #f9f9f9;
        }
        .action-btn {
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            margin-right: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        .delete-btn {
            background-color: #D32F2F;
        }
        .tab-container {
            margin-bottom: 20px;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 4px 4px 0 0;
        }
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
        }
        .tab-content {
            display: none;
            padding: 20px;
            background-color: white;
            border: 1px solid #ddd;
            border-top: none;
        }
        .tab-content.active {
            display: block;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            gap: 20px;
        }
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .btn-primary {
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            font-weight: bold;
        }
        .username-display {
            font-size: 14px;
            color: #333;
            margin-left: 10px;
        }
        .messages-container {
            padding: 0 20px;
            margin-bottom: 20px;
        }
        .message-alert {
            padding: 12px 20px;
            margin-bottom: 15px;
            border-radius: 4px;
            position: relative;
        }
        .message-alert.success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }
        .message-alert.error {
            background-color: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }
        .message-alert.info {
            background-color: #e3f2fd;
            color: #0d47a1;
            border-left: 4px solid #0d47a1;
        }
        .close-message {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: inherit;
        }
        .badge {
            background-color: #ef4444;
            color: white;
            border-radius: 12px;
            padding: 3px 8px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-left: 10px;
        }
        .approvals-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .approval-card {
            background-color: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #3b82f6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .approval-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 10px;
        }
        .approval-name {
            font-weight: bold;
            color: #1e293b;
            font-size: 16px;
        }
        .approval-username {
            color: #64748b;
            font-size: 14px;
        }
        .approval-details {
            margin-bottom: 15px;
        }
        .approval-details p {
            margin: 5px 0;
            color: #334155;
        }
        .approval-actions {
            display: flex;
            gap: 10px;
        }
        .approval-form {
            display: inline-block;
        }
        .approve-btn {
            background-color: #22c55e;
        }
        .approve-btn:hover {
            background-color: #16a34a;
        }
        .logo {
        display: block;
        max-width: 80px;
        height: auto;
        margin: 0 auto;
        }
    </style>
</head>
<body>
    {% load static %}
    <div class="container">
        <div class="sidebar" id="sidebar">
            <img src="{% static 'images/Sky_Group_logo_2020.svg.png' %}" alt="Company Logo" class="logo">
            <div class="app-logo">
                Health<span>Check</span>Admin
            </div>
            <div class="sidebar-buttons">
                <button class="sidebar-button active-button">Admin Dashboard</button>
                <a href="{% url 'admin_projects' %}" style="text-decoration: none; width: 100%;">
                    <button class="sidebar-button">Project Management</button>
                </a>
                <a href="{% url 'team_selection' %}" style="text-decoration: none; width: 100%;">
                    <button class="sidebar-button">Team Health Checks</button>
                </a>
                <a href="{% url 'settings' %}" style="text-decoration: none; width: 100%;">
                    <button class="sidebar-button">Settings</button>
                </a>
            </div>
            <a href="{% url 'logout' %}" style="text-decoration: none; margin-top: auto; display: block;" id="logout-link">
                <button class="sidebar-button logout-button">Log Out</button>
            </a>
        </div>
        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <span class="menu-icon" id="toggle-sidebar">â‰¡</span>
                </div>
                <div class="header-right">
                    <span class="notification-icon">ðŸ””</span>
                    <span class="username-display">Welcome, 
                        {% if user.first_name %}
                            {{ user.first_name }} {{ user.last_name }}
                        {% else %}
                            {{ username }}
                        {% endif %}
                    </span>
                </div>
            </div>
            
            {% if messages %}
            <div class="messages-container">
                {% for message in messages %}
                <div class="message-alert {% if message.tags %}{{ message.tags }}{% endif %}">
                    {{ message }}
                    <button class="close-message">&times;</button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        
            
            <h1 class="admin-title">Admin Dashboard</h1>
            
            <div class="quick-stats">
                <div class="stat-card">
                    <h3>Total Users</h3>
                    <p>{{ total_users }}</p>
                </div>
                <div class="stat-card">
                    <h3>Active Projects</h3>
                    <p>{{ active_projects }}</p>
                </div>
                <div class="stat-card">
                    <h3>Pending Approvals</h3>
                    <p>{{ pending_count }}</p>
                </div>
                <div class="stat-card">
                    <h3>Total Projects</h3>
                    <p>{{ total_projects }}</p>
                </div>
            </div>
            
            {% if pending_count > 0 %}
            <div class="admin-section" id="pending-approvals-section">
                <h2 class="section-title">Pending Employee Approvals <span class="badge">{{ pending_count }}</span></h2>
                <div class="approvals-container">
                    {% for profile in pending_approvals %}
                    <div class="approval-card">
                        <div class="approval-header">
                            <span class="approval-name">{{ profile.user.first_name }} {{ profile.user.last_name }}</span>
                            <span class="approval-username">@{{ profile.user.username }}</span>
                        </div>
                        <div class="approval-details">
                            <p><strong>Email:</strong> {{ profile.user.email }}</p>
                            <p><strong>Role:</strong> {{ profile.get_role_display }}</p>
                            <p><strong>Company:</strong> {{ profile.company.name }}</p>
                            <p><strong>Registered:</strong> {{ profile.user.date_joined|date:"M d, Y" }}</p>
                        </div>
                        <div class="approval-actions">
                            <form method="post" action="{% url 'approve_employee' profile.user.id %}" class="approval-form">
                                {% csrf_token %}
                                <button type="submit" class="action-btn approve-btn">Approve</button>
                            </form>
                            <form method="post" action="{% url 'reject_employee' profile.user.id %}" class="approval-form">
                                {% csrf_token %}
                                <button type="submit" class="action-btn delete-btn">Reject</button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            {% if pending_projects_count > 0 %}
            <div class="admin-section" id="pending-projects-section">
                <h2 class="section-title">Pending Project Approvals <span class="badge">{{ pending_projects_count }}</span></h2>
                <div class="approvals-container">
                    {% for project in pending_projects %}
                    <div class="approval-card">
                        <div class="approval-header">
                            <span class="approval-name">{{ project.name }}</span>
                            <span class="approval-date">Created: {{ project.created_at|date:"M d, Y" }}</span>
                        </div>
                        <div class="approval-details">
                            <p><strong>Created by:</strong> {{ project.created_by.username }} ({{ project.created_by.first_name }} {{ project.created_by.last_name }})</p>
                            <p><strong>Team:</strong> {{ project.team.name }}</p>
                            <p><strong>Department:</strong> {{ project.department.name }}</p>
                            <p><strong>Description:</strong> {{ project.description|default:"No description" }}</p>
                        </div>
                        <div class="approval-actions">
                            <form method="post" action="{% url 'approve_project' project.id %}" class="approval-form">
                                {% csrf_token %}
                                <button type="submit" class="action-btn approve-btn">Approve Project</button>
                            </form>
                            <form method="post" action="{% url 'reject_project' project.id %}" class="approval-form">
                                {% csrf_token %}
                                <button type="submit" class="action-btn delete-btn">Reject Project</button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <div class="tab-container">
                <div class="tabs">
                    <div class="tab active" onclick="openTab(event, 'users')">User Management</div>
                    <div class="tab" onclick="openTab(event, 'teams')">Team Management</div>
                    <div class="tab" onclick="openTab(event, 'projects')">Project Management</div>
                    <div class="tab" onclick="openTab(event, 'settings')">System Settings</div>
                    <div class="tab" onclick="openTab(event, 'logs')">Activity Logs</div>
                </div>
                
                <div id="users" class="tab-content active">
                    <div class="admin-section">
                        <h2 class="section-title">User Management</h2>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Username</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Assigned to Team</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for profile in user_profiles %}
                                <tr>
                                    <td>{{ profile.user.id }}</td>
                                    <td>{{ profile.user.username }}</td>
                                    <td>{{ profile.user.first_name }} {{ profile.user.last_name }}</td>
                                    <td>{{ profile.user.email }}</td>
                                    <td>{{ profile.get_role_display }}</td>
                                    <td>
                                      {% if profile.teams.all %}
                                        {% for team in profile.teams.all %}
                                          {{ team.name }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                      {% else %}
                                        No team
                                      {% endif %}
                                    </td>
                                    <td>
                                        {% if profile.user.id != user.id %}
                                            <button class="action-btn">Edit</button>
                                            <form method="post" action="{% url 'delete_user' profile.user.id %}" class="delete-form" style="display: inline;">
                                                {% csrf_token %}
                                                <button type="submit" class="action-btn delete-btn" onclick="return confirm('Are you sure you want to remove this user?');">Delete</button>
                                            </form>
                                        {% else %}
                                            <span class="badge" style="background-color: #3b82f6;">Current User</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7">No users found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="teams" class="tab-content">
                    <div class="admin-section">
                        <h2 class="section-title">Create New Department</h2>
                        <form method="post" action="{% url 'create_department' %}" class="department-form">
                            {% csrf_token %}
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="department_name">Department Name*</label>
                                    <input type="text" id="department_name" name="department_name" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="department_code">Department Code*</label>
                                    <input type="text" id="department_code" name="department_code" class="form-control" required>
                                    <small class="helptext">A unique code for the department (e.g., HR, IT, FINANCE)</small>
                                </div>
                            </div>
                            <button type="submit" class="btn-primary">Create Department</button>
                        </form>
                    </div>
                    
                    <div class="admin-section">
                        <h2 class="section-title">Existing Departments</h2>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Department Name</th>
                                    <th>Department Code</th>
                                    <th>Department Lead</th>
                                    <th>Teams</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for department in departments %}
                                <tr>
                                    <td>{{ department.id }}</td>
                                    <td>{{ department.name }}</td>
                                    <td>{{ department.code }}</td>
                                    <td>
                                        {% for user in user_profiles %}
                                            {% if user.is_department_lead and user.department and user.department.id == department.id %}
                                                {{ user.user.first_name }} {{ user.user.last_name }}
                                            {% endif %}
                                        {% endfor %}
                                    </td>
                                    <td>{{ department.teams.count }}</td>
                                    <td>
                                        <button class="action-btn" onclick="openDepartmentModal({{ department.id }})">Edit</button>
                                        <button class="action-btn delete-btn">Delete</button>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="6">No departments found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="admin-section">
                        <h2 class="section-title">Create New Team</h2>
                        <form method="post" action="{% url 'create_team' %}" class="team-form">
                            {% csrf_token %}
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="team_name">Team Name*</label>
                                    <input type="text" id="team_name" name="team_name" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="team_code">Team Code*</label>
                                    <input type="text" id="team_code" name="team_code" class="form-control" required>
                                    <small class="helptext">A unique code for the team (e.g., DEV01, MARKETING)</small>
                                </div>
                                <div class="form-group">
                                    <label for="department">Department*</label>
                                    <select id="department" name="department" class="form-control" required>
                                        <option value="">-- Select Department --</option>
                                        {% for department in departments %}
                                        <option value="{{ department.id }}">{{ department.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn-primary">Create Team</button>
                        </form>
                    </div>
                    
                    <div class="admin-section">
                        <h2 class="section-title">Existing Teams</h2>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Team Name</th>
                                    <th>Team Code</th>
                                    <th>Department</th>
                                    <th>Team Leader</th>
                                    <th>Members</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for team in teams %}
                                <tr>
                                    <td>{{ team.id }}</td>
                                    <td>{{ team.name }}</td>
                                    <td>{{ team.code }}</td>
                                    <td>{{ team.department.name }}</td>
                                    <td>
                                        {% for member in team.team_members.all %}
                                            {% if member.is_team_leader and team in member.teams.all %}
                                                {{ member.user.first_name }} {{ member.user.last_name }}
                                            {% endif %}
                                        {% endfor %}
                                    </td>
                                    <td>
                                        {% for member in team.team_members.all %}
                                            {{ member.user.first_name }} {{ member.user.last_name }}{% if not forloop.last %}, {% endif %}
                                        {% empty %}
                                            No members
                                        {% endfor %}
                                    </td>
                                    <td>
                                        <button class="action-btn" onclick="openTeamModal({{ team.id }})">Edit</button>
                                        <button class="action-btn delete-btn">Delete</button>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7">No teams found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    {% if pending_team_requests_count > 0 %}
                    <div class="admin-section">
                        <h2 class="section-title">Team Join Requests <span class="badge">{{ pending_team_requests_count }}</span></h2>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Role</th>
                                    <th>Team</th>
                                    <th>Requested On</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for request in pending_team_requests %}
                                <tr>
                                    <td>{{ request.user.first_name }} {{ request.user.last_name }}</td>
                                    <td>{{ request.user.profile.get_technical_role_display }}</td>
                                    <td>{{ request.team.name }}</td>
                                    <td>{{ request.requested_at|date:"M d, Y" }}</td>
                                    <td>
                                        <form method="post" action="{% url 'approve_team_request' request.id %}" style="display: inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="action-btn approve-btn">Approve</button>
                                        </form>
                                        <form method="post" action="{% url 'reject_team_request' request.id %}" style="display: inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="action-btn delete-btn">Reject</button>
                                        </form>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5">No pending team join requests</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}
                </div>
                
                <div id="projects" class="tab-content">
                    <div class="admin-section">
                        <h2 class="section-title">Project Management</h2>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Project Name</th>
                                    <th>Created By</th>
                                    <th>Status</th>
                                    <th>Health</th>
                                    <th>Team</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for project in projects %}
                                <tr>
                                    <td>{{ project.id }}</td>
                                    <td>{{ project.name }}</td>
                                    <td>{{ project.created_by.username }}</td>
                                    <td>{{ project.get_status_display }}</td>
                                    <td>{{ project.get_health_display }}</td>
                                    <td>{{ project.team.name }}</td>
                                    <td>
                                        <button class="action-btn">Edit</button>
                                        <button class="action-btn delete-btn">Delete</button>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7">No projects found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="settings" class="tab-content">
                    <div class="admin-section">
                        <h2 class="section-title">System Settings</h2>
                        <form>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="siteTitle">Site Title</label>
                                    <input type="text" id="siteTitle" class="form-control" value="Health Check App">
                                </div>
                                <div class="form-group">
                                    <label for="adminEmail">Admin Email</label>
                                    <input type="email" id="adminEmail" class="form-control" value="{{ user.email }}">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="timezone">Timezone</label>
                                    <select id="timezone" class="form-control">
                                        <option>UTC</option>
                                        <option selected>America/New_York</option>
                                        <option>Europe/London</option>
                                        <option>Asia/Tokyo</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="dateFormat">Date Format</label>
                                    <select id="dateFormat" class="form-control">
                                        <option selected>MM/DD/YYYY</option>
                                        <option>DD/MM/YYYY</option>
                                        <option>YYYY-MM-DD</option>
                                    </select>
                                </div>
                            </div>
                            <button type="button" class="btn-primary">Save Settings</button>
                        </form>
                    </div>
                </div>
                
                <div id="logs" class="tab-content">
                    <div class="admin-section">
                        <h2 class="section-title">Activity Logs</h2>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Date/Time</th>
                                    <th>User</th>
                                    <th>Action</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4">No logs available yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Department Edit Modal -->
    <div id="editDepartmentModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:1000; align-items:center; justify-content:center;">
      <div style="background:#fff; padding:30px; border-radius:8px; min-width:320px; max-width:90vw;">
        <h4>Assign Department Lead</h4>
        <form method="post" action="" id="assignDepartmentLeadForm">
          {% csrf_token %}
          <input type="hidden" name="department_id" id="editDepartmentId">
          <div class="form-group">
            <label for="department_lead">Select Department Lead</label>
            <select name="department_lead" id="departmentLeadSelect" class="form-control" required>
              <option value="">-- Select User --</option>
              {% for user in user_profiles %}
                <option value="{{ user.user.id }}">{{ user.user.first_name }} {{ user.user.last_name }} ({{ user.user.username }})</option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="btn-primary">Assign Lead</button>
          <button type="button" onclick="closeDepartmentModal()" class="btn-secondary" style="margin-left:10px;">Cancel</button>
        </form>
      </div>
    </div>

    <!-- Team Edit Modal -->
    <div id="editTeamModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:1000; align-items:center; justify-content:center;">
      <div style="background:#fff; padding:30px; border-radius:8px; min-width:320px; max-width:90vw;">
        <h4>Edit Team</h4>
        <form method="post" action="" id="addTeamMembersForm">
          {% csrf_token %}
          <input type="hidden" name="team_id" id="editTeamId">
          <div class="form-group">
            <label for="team_leader">Select Team Leader</label>
            <select name="team_leader" id="teamLeaderSelect" class="form-control" required>
              <option value="">-- Select Team Leader --</option>
              {% for user in user_profiles %}
                <option value="{{ user.user.id }}">{{ user.user.first_name }} {{ user.user.last_name }} ({{ user.user.username }})</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="team_members">Select Members</label>
            <select name="team_members" id="teamMembersSelect" class="form-control" multiple required>
              {% for user in user_profiles %}
                <option value="{{ user.user.id }}">{{ user.user.first_name }} {{ user.user.last_name }} ({{ user.user.username }})</option>
              {% endfor %}
            </select>
            <small>Select one or more users to add to this team.</small>
          </div>
          <button type="submit" class="btn-primary">Save Changes</button>
          <button type="button" onclick="closeTeamModal()" class="btn-secondary" style="margin-left:10px;">Cancel</button>
        </form>
      </div>
    </div>

    <script>
        function openTab(evt, tabName) {
            // Hide all tab content
            var tabContent = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabContent.length; i++) {
                tabContent[i].className = tabContent[i].className.replace(" active", "");
            }
            
            // Remove active class from all tabs
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            
            // Show the current tab and add an "active" class to the button that opened the tab
            document.getElementById(tabName).className += " active";
            evt.currentTarget.className += " active";
        }
        
        // Sidebar toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const toggleButton = document.getElementById('toggle-sidebar');
            const sidebar = document.getElementById('sidebar');
            
            toggleButton.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
            });
            
            // Logout confirmation
            const logoutButton = document.querySelector('.logout-button');
            logoutButton.addEventListener('click', function(event) {
                event.preventDefault();
                if (confirm('Are you sure you want to log out?')) {
                    window.location = "{% url 'logout' %}";
                }
            });
            
            // Close message alerts
            const closeButtons = document.querySelectorAll('.close-message');
            closeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    this.parentElement.style.display = 'none';
                });
            });
            
            // Auto-hide messages after 5 seconds
            setTimeout(function() {
                const messages = document.querySelectorAll('.message-alert');
                messages.forEach(message => {
                    message.style.display = 'none';
                });
            }, 5000);
        });

        function openDepartmentModal(deptId) {
          document.getElementById('editDepartmentId').value = deptId;
          document.getElementById('assignDepartmentLeadForm').action = `/assign-department-lead/${deptId}/`;
          document.getElementById('editDepartmentModal').style.display = 'flex';
        }
        function closeDepartmentModal() {
          document.getElementById('editDepartmentModal').style.display = 'none';
        }
        function openTeamModal(teamId) {
          document.getElementById('editTeamId').value = teamId;
          document.getElementById('addTeamMembersForm').action = `/add-team-members/${teamId}/`;
          document.getElementById('editTeamModal').style.display = 'flex';
        }
        function closeTeamModal() {
          document.getElementById('editTeamModal').style.display = 'none';
        }
    </script>
</body>
</html> 